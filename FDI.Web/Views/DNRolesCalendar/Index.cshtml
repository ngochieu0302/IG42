@model FDI.Simple.ModelDNRolesItem
@{
    Layout =  "~/Views/Shared/_Meta.cshtml";
    var datenow = DateTime.Now;

}
<script type="text/javascript">
    Date.prototype.getWeek = function () {
        var onejan = new Date(this.getFullYear(), 0, 1);
        return Math.ceil((((this - onejan) / 86400000) + onejan.getDay() + 1) / 7);
    };
    $(document).ready(function () {
        callSelect2("#UserId", "100%");
        callSelect2("#YearId", "225px");
        callSelect2("#ddlWeek", "225px");
		var yearNow = (new Date()).getFullYear();
        $('body').on("change", "#ddlWeek", function () {
			var numberWeek = $("#ddlWeek").val();
			var year = $("#YearId").val();
            var userId = $("#UserId").val();
            $.post("@Url.Action("ListItems", "DNRolesCalendar")?roleId=" + userId + "&year=" + year + "&weekNumber=" + numberWeek, function (data) {
                $("#Griditems").html(data);
            });
		});
		$('body').on("change", "#YearId", function () {
			var numberWeek = $("#ddlWeek").val();
			var year = $("#YearId").val();
		    var userId = $("#UserId").val();
			$.post("@Url.Action("ListWeekByYear", "DNRolesCalendar")?year=" + year, function (data) {
				$('#ddlWeek').children().remove();
				$('#ddlWeek').append(data);
				$('select.s2change').select2().select2('val', $('.s2change option:eq(0)').val());
			});
		    $.post("@Url.Action("ListItems", "DNRolesCalendar")?roleId=" + userId + "&year=" + year + "&weekNumber=" + 1, function (data) {
			    $("#Griditems").html(data);
		    });
	    });

        $('body').on("change", "#UserId", function () {
			var numberWeek = $("#ddlWeek").val();
	        var year = $("#YearId").val();
            $.post("@Url.Action("ListItems", "DNRolesCalendar")?roleId=" + $(this).val() + "&year= " + year +"&weekNumber=" + numberWeek, function (data) {
                $("#Griditems").html(data);
            });
        });

        $("#_back").click(function () {
            var numberWeek = $("#ddlWeek").val();
			numberWeek = parseInt(numberWeek) - 1;
			var year = $("#YearId").val();
	        var userId = $("#UserId").val();
            if (numberWeek > 0) {
                $('#ddlWeek').val(numberWeek).trigger("change");
	            $.post("@Url.Action("ListItems", "DNRolesCalendar")?roleId=" + userId + "&year=" + year + "&weekNumber=" + numberWeek, function (data) {
		            $("#Griditems").html(data);
	            });
            }
        });
        var listWeekOfYear = '@Model.ListWeekItems.Count()';
        $("#_next").click(function () {
            var numberWeek = $("#ddlWeek").val();
			numberWeek = parseInt(numberWeek) + 1;
	        var year = $("#YearId").val();
	        var userId = $("#UserId").val();
            if (numberWeek <= parseInt(listWeekOfYear)) {
                $('#ddlWeek').val(numberWeek).trigger("change");
	            $.post("@Url.Action("ListItems", "DNRolesCalendar")?roleId=" + userId + "&year=" + year + "&weekNumber=" + numberWeek, function (data) {
		            $("#Griditems").html(data);
	            });
            }
        });

       
    });

</script>
<div class="header-control">
    <h3 class="page-title"></h3>
    <div class="group-form-control">
        <form id="gridSearch" class="form-inline" role="form">
            <div class="form-group">
                <select id="UserId" name="UserId" class="select2">
                    <option value="">--- Chọn nhóm ---</option>
                    @foreach (var item in Model.ListItem)
                    {
                        <option @(item.RoleId == Model.RoleId ? "selected" : "") value="@item.RoleId">@item.RoleName</option>
                    }
                </select>
            </div>
             <div class="form-group">
                <select id="YearId" name="YearId" class="select2">
                    @for (var i = datenow.Year - 2; i < datenow.Year + 3; i++)
                    {
                        <option @(i == datenow.Year ? "selected" : "") value="@i">@i</option>
                    }
                </select>
            </div>
            <div class="form-group">
                <button type="button" class="btn btn-sm btn-success" id="_back"><i class="fa fa-angle-left"></i></button>
                <select id="ddlWeek" name="ddlWeek" class="select2 s2change">
	                @*@Html.Action("ListWeekByYear", "DNRolesCalendar")*@
	                @foreach (var itemWeek in Model.ListWeekItems)
	                {
		                <option value="@itemWeek.ID" @(itemWeek.MonToSun.Any(m => m == DateTime.Today) ? "selected" : string.Empty)>@("Tuần " + itemWeek.ID) - (@itemWeek.MonToSunView)</option>
	                }
                </select>
                <button class="btn btn-sm btn-success" type="button" id="_next"><i class="fa fa-angle-right"></i></button>
            </div>
            <div class="btn-group pull-right">
            </div>
        </form>
    </div>
</div>