@model dynamic

<!DOCTYPE html>
<html lang="vi" class="app">
<head>
    <meta charset="utf-8" />
    <title>Admin | @ViewBag.Title</title>
    <link href="https://fditech.vn/favicon.svg" rel="shortcut icon" type="image/x-icon" />
    <meta name="description" content="" />
    <!-- BEGIN GLOBAL MANDATORY STYLES -->
    <link href="/Content/Admin/plugins/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css" />
    <link href="/Content/Admin/plugins/simple-line-icons/simple-line-icons.min.css" rel="stylesheet" type="text/css" />
    <link href="/Content/Admin/plugins/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
    <!-- END GLOBAL MANDATORY STYLES -->
    <!-- BEGIN THEME GLOBAL STYLES -->
    <link href="/Content/Admin/css/components.min.css" rel="stylesheet" type="text/css" />
    <link href="/Content/Admin/css/plugins.min.css" rel="stylesheet" type="text/css" />
    <link href="/Content/Admin/css/layout.min.css" rel="stylesheet" type="text/css" />
    <link href="/Content/Admin/css/darkblue.min.css" rel="stylesheet" type="text/css" />
    <link href="/Content/Admin/plugins/bootstrap-toastr/toastr.min.css" rel="stylesheet" type="text/css">
    <link href="/Content/Admin/plugins/bootstrap-modal/css/bootstrap-modal-bs3patch.css" rel="stylesheet" type="text/css" />
    <link href="/Content/Admin/plugins/bootstrap-modal/css/bootstrap-modal.css" rel="stylesheet" type="text/css" />
    <link href="/Content/Admin/plugins/bootstrap-datepicker/css/bootstrap-datepicker3.min.css" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" href="/Content/Admin/plugins/clockface/css/clockface.css">
    <link href="/Content/Admin/plugins/icheck/skins/all.css" rel="stylesheet" type="text/css" />
    <link href="/Content/Admin/css/custom.min.css" rel="stylesheet" type="text/css" />

    <!-- BEGIN THEME GLOBAL SCRIPTS -->

    <script src="/Content/Admin/plugins/jquery.min.js" type="text/javascript"></script>
    <script src="/Content/Admin/plugins/jquery.blockui.min.js" type="text/javascript"></script>
    <script src="/Content/Admin/js/jquery.address-1.6.min.js" type="text/javascript"></script>
    <script src="/Content/Admin/plugins/bootstrap-datepicker/js/bootstrap-datepicker.min.js" type="text/javascript"></script>
    <script src="/Content/Admin/plugins/clockface/js/clockface.js"></script>
    <script src="/Content/Admin/js/jquery.mask.js"></script>
    <script src="/Content/Admin/js/jquery.multiselect.js" type="text/javascript"></script>
    <script src="/Content/Admin/js/jquery.treeview.js" type="text/javascript"></script>
    <script src="/Scripts/jquery.validate.min.js" type="text/javascript"></script>
    <script src="/Content/Admin/js/jquery.autocomplete.js"></script>
    <script src="~/Content/Admin/js/jquery.magnific.min.js" type="text/javascript"></script>

    <script src="/Content/Admin/js/GridView.js" type="text/javascript"></script>
    <script src="/ckeditor/ckeditor.js" type="text/javascript"></script>
    <script src="/ckfinder/ckfinder.js" type="text/javascript"></script>
    <script src="/Content/Admin/js/jquery.lazyload.min.js" type="text/javascript"></script>
    <script src="/Content/Admin/js/CarMarket.js" type="text/javascript"></script>
    <script src="/Content/Admin/js/purl.js"></script>
    <script src="/Content/Admin/plugins/icheck/icheck.min.js" type="text/javascript"></script>
    <script src="/Content/Admin/plugins/form-icheck.min.js" type="text/javascript"></script>
    <!-- BEGIN THEME GLOBAL SCRIPTS --> 

    <script src="/Content/Admin/plugins/select2/js/select2.min.js"></script>
    <link href="/Content/Admin/plugins/select2/css/select2.min.css" rel="stylesheet" />
    <!-- END THEME GLOBAL SCRIPTS -->

</head>
<body class="page-header-fixed page-sidebar-closed-hide-logo page-content-white page-sidebar-fixed">
    <div class="page-header navbar navbar-fixed-top">
        <div class="page-header-inner ">
            <!-- BEGIN LOGO -->
            <div class="page-logo">
                <a href="/" target="_blank">
                    <img src="https://fditech.vn/Content/Publishing/img/logo-full.svg" width="300" height="40" alt="logo" class="logo-default" />
                </a>
                <div class="menu-toggler sidebar-toggler"></div>
            </div>
            <form class="search-form" method="GET" _lpchecked="1" target="_blank">
                <div class="input-group">
                    <input type="text" class="form-control" placeholder="Search..." name="keyword">
                    <span class="input-group-btn">
                        <a href="javascript:;" class="btn submit">
                            <i class="icon-magnifier"></i>
                        </a>
                    </span>
                </div>
            </form>
            <!-- END LOGO -->
            <!-- BEGIN RESPONSIVE MENU TOGGLER -->
            <a href="javascript:;" class="menu-toggler responsive-toggler" data-toggle="collapse" data-target=".navbar-collapse"></a>
            <!-- END RESPONSIVE MENU TOGGLER -->
            <!-- BEGIN TOP NAVIGATION MENU -->
            <div class="top-menu">
                <ul class="nav navbar-nav pull-right">
                    @Html.Action("Agency", "AdminDN")
                </ul>
            </div>
            <!-- END TOP NAVIGATION MENU -->
        </div>
    </div>
    <div class="page-container">
        <div class="page-sidebar-wrapper">
            <div class="page-sidebar navbar-collapse collapse">
                @Html.Action("Menu", "AdminDN")
            </div>
        </div>
        <div class="page-content-wrapper">
            <div class="page-content height-auto">
                @RenderBody()
            </div>
        </div>
        <a href="javascript:;" class="page-quick-sidebar-toggler">
            <i class="icon-login"></i>
        </a>

    </div>
    <div class="hidden">
        <div id="dialog-confirm">
        </div>
        <div id="dialog-message">
        </div>
        <div id="dialog-form">
        </div>
        <div id="dialog-form-2">
        </div>
        <div id="dialog-form-3">
        </div>
        <div id="dialog-AddPicture">
        </div>
        <div id="dialog-Picture">
        </div>
    </div>
    <!-- Bootstrap -->
    <script src="/Content/Admin/plugins/bootstrap/js/bootstrap.min.js" type="text/javascript"></script>
    <script src="/Content/Admin/plugins/jquery-slimscroll/jquery.slimscroll.min.js" type="text/javascript"></script>
    <!-- END CORE PLUGINS -->
    <!-- END PAGE LEVEL PLUGINS -->
    <script src="/Content/Admin/plugins/bootstrap-toastr/toastr.min.js" type="text/javascript"></script>
    <script src="/Content/Admin/plugins/ui-toastr.min.js" type="text/javascript"></script>
    <script src="/Content/Admin/plugins/bootstrap-sweetalert/sweetalert.min.js" type="text/javascript"></script>
    <script src="/Content/Admin/plugins/bootstrap-sweetalert/ui-sweetalert.min.js" type="text/javascript"></script>
    <!-- BEGIN PAGE LEVEL PLUGINS -->

    <script src="/Content/Admin/plugins/bootstrap-modal/js/bootstrap-modalmanager.js" type="text/javascript"></script>
    <script src="/Content/Admin/plugins/bootstrap-modal/js/bootstrap-modal.js" type="text/javascript"></script>
    <!-- END PAGE LEVEL PLUGINS -->
    <!-- BEGIN THEME GLOBAL SCRIPTS -->
    <script src="/Content/Admin/plugins/ui-extended-modals.min.js" type="text/javascript"></script>
    <!-- BEGIN PAGE LEVEL PLUGINS -->
    <!-- END THEME LAYOUT SCRIPTS -->

    <script src="/Content/Admin/js/Common.js"></script>
    <script type="text/javascript">
        //<![CDATA[
        $(function () {
            $(".dialog-form").on("dialogcreate", function () {
                $("body").css({ overflow: 'hidden' });
            });
            $(".dialog-form").on("dialogbeforeclose", function () {
                $("body").css({ overflow: 'inherit' });
            });
        })
    //]]>
    </script>
    <script src="~/Content/socket/socket.io.js"></script>
<script>
    var socket = io("http://192.168.100.23:1000");

    function toDateTime(secs) {
        var t = new Date(2016, 1, 1); // Epoch
        t.setSeconds(secs);
        return t;
    }

    socket.on("server-send-mail", function (data) {
        var obj = jQuery.parseJSON(data);
        if (obj.length > 0) {
            $("#MailInbox").html(obj.length);
        } else {
            $("#MailInbox").html('');
        }

    });

    socket.on("server-save-drafts", function (data) {
        var obj = jQuery.parseJSON(data);
        if (obj.length > 0) {
            $("#MailDrafts").html(obj.length);
        } else {
            $("#MailDrafts").html("");
        }
    });
    
    socket.on("server-send-auto-draft", function (data) {
        var obj = jQuery.parseJSON(data);
        if (obj.length > 0) {
            setTimeout(function() {
                $("#MailDrafts").html(obj.length);
            }, 3000);
        } else {
            $("#MailDrafts").html("");
        }
    });


    // cho vào thùng rác
    socket.on("server-save-recyclebin", function (data) {
        var obj = jQuery.parseJSON(data.lstEmail);
        $("#TotalRecord").html(obj.length);
        if (data.type == 1) {
            if (obj.length > 0) {
                $("#MailInbox").html(obj.length);

            } else {
                $("#MailInbox").html("");
            }
        }
     
        else if (data.type == 3) {
            if (obj.length > 0) {
                $("#MailDrafts").html(obj.length);

            } else {
                $("#MailDrafts").html("");
            }
        }
        else if (data.type == 4) {
            if (obj.length > 0) {
                $("#MailSpam").html(obj.length);

            } else {
                $("#MailSpam").html("");
            }
        }
        
        $("#contentEmail").html("");
        $.each(obj, function (i, val) {
            $("#contentEmail").append(
                "<tr class=\"\" data-id=\"" + val.ID + "\">" +
                    "<td><input type=\"checkbox\" class=\"chkEmail\" value=" + val.ID + "></td>" +
                    "<td class=\"inbox-small-cells\"><i class=\"fa fa-star\"></i></td>" +
                    "<td class=\"view-message hidden-xs\"><a data-id=\"" + val.ID + " class=\"titleEmail\">" + val.UserSendName + "</a></td>" +
                    "<td class=\"view-message\"><a data-id=\"" + val.ID + " class=\"titleEmail\">" + val.Title + "</a></td>" +
                    "<td class=\"view-message inbox-small-cells\"><i class=\"fa fa-paperclip\"></i></td>" +
                    "<td class=\"view-message text-right\"><a data-id=\"" + val.ID + " class=\"titleEmail\">" + toDateTime(val.CreateDate).toLocaleDateString() + " " + toDateTime(val.CreateDate).toLocaleTimeString() + " </a></td>" +
                "</tr>");
        });
    });

    // spam server
    socket.on("server-save-spam", function (data) {
        var lstSpam = jQuery.parseJSON(data.ListSpam);
        var lstInbox = jQuery.parseJSON(data.ListInbox);
        if (data.type == 1) {
            if (lstInbox.length > 0) {
                $("#MailInbox").html(lstInbox.length);

            } else {
                $("#MailInbox").html("");
            }
        }
        $("#TotalRecord").html(lstInbox.length);
        $("#MailSpam").html(lstSpam.length);
        $("#contentEmail").html("");
        $.each(lstInbox, function (i, val) {
            $("#contentEmail").append(
                "<tr class=\"\" data-id=\"" + val.ID + "\">" +
                    "<td><input type=\"checkbox\" class=\"chkEmail\" value=" + val.ID + "></td>" +
                    "<td class=\"inbox-small-cells\"><i class=\"fa fa-star\"></i></td>" +
                    "<td class=\"view-message hidden-xs\"><a data-id=\"" + val.ID + " class=\"titleEmail\">" + val.UserSendName + "</a></td>" +
                    "<td class=\"view-message\"><a data-id=\"" + val.ID + " class=\"titleEmail\">" + val.Title + "</a></td>" +
                    "<td class=\"view-message inbox-small-cells\"><i class=\"fa fa-paperclip\"></i></td>" +
                    "<td class=\"view-message text-right\"><a data-id=\"" + val.ID + " class=\"titleEmail\">" + toDateTime(val.CreateDate).toLocaleDateString() + " " + toDateTime(val.CreateDate).toLocaleTimeString() + " </a></td>" +
                "</tr>");
        });
    });

    // không phải spam
    socket.on("server-save-no-spam", function (data) {
        var lstSpam = jQuery.parseJSON(data);
        if (lstSpam.length > 0) {
            $("#MailSpam").html(lstSpam.length);

        } else {
            $("#MailSpam").html("");
        }
        $("#TotalRecord").html(lstSpam.length);
        $("#contentEmail").html("");
        $.each(lstSpam, function (i, val) {
            $("#contentEmail").append(
                "<tr class=\"\" data-id=\"" + val.ID + "\">" +
                    "<td><input type=\"checkbox\" class=\"chkEmail\" value=" + val.ID + "></td>" +
                    "<td class=\"inbox-small-cells\"><i class=\"fa fa-star\"></i></td>" +
                    "<td class=\"view-message hidden-xs\"><a data-id=\"" + val.ID + " class=\"titleEmail\">" + val.UserSendName + "</a></td>" +
                    "<td class=\"view-message\"><a data-id=\"" + val.ID + " class=\"titleEmail\">" + val.Title + "</a></td>" +
                    "<td class=\"view-message inbox-small-cells\"><i class=\"fa fa-paperclip\"></i></td>" +
                    "<td class=\"view-message text-right\"><a data-id=\"" + val.ID + " class=\"titleEmail\">" + toDateTime(val.CreateDate).toLocaleDateString() + " " + toDateTime(val.CreateDate).toLocaleTimeString() + " </a></td>" +
                "</tr>");
        });
    });

    // xóa vĩnh viễn
    socket.on("server-save-delete", function (data) {
        var lstSpam = jQuery.parseJSON(data.lstEmail);
        $("#contentEmail").html("");
        if (data.type == 4) {
            $("#MailSpam").html(lstSpam.length > 0 ? lstSpam.length : "");
        }
        else {
            $("#TotalRecord").html(lstSpam.length);
        }
        $.each(lstSpam, function (i, val) {
            $("#contentEmail").append(
                "<tr class=\"\" data-id=\"" + val.ID + "\">" +
                    "<td><input type=\"checkbox\" class=\"chkEmail\" value=" + val.ID + "></td>" +
                    "<td class=\"inbox-small-cells\"><i class=\"fa fa-star\"></i></td>" +
                    "<td class=\"view-message hidden-xs\"><a data-id=\"" + val.ID + " class=\"titleEmail\">" + val.UserSendName + "</a></td>" +
                    "<td class=\"view-message\"><a data-id=\"" + val.ID + " class=\"titleEmail\">" + val.Title + "</a></td>" +
                    "<td class=\"view-message inbox-small-cells\"><i class=\"fa fa-paperclip\"></i></td>" +
                    "<td class=\"view-message text-right\"><a data-id=\"" + val.ID + " class=\"titleEmail\">" + toDateTime(val.CreateDate).toLocaleDateString() + " " + toDateTime(val.CreateDate).toLocaleTimeString() + " </a></td>" +
                "</tr>");
        });
    });

    // chuyển thư nháp đến hộp thư đến
    socket.on("server-send-move-mailbox", function (data) {
        var lstSpam = jQuery.parseJSON(data);
        if (lstSpam.length > 0) {
            $("#MailDrafts").html(lstSpam.length);

        } else {
            $("#MailDrafts").html("");
        }
        $("#TotalRecord").html(lstSpam.length);
        $("#contentEmail").html("");
        $.each(lstSpam, function (i, val) {
            $("#contentEmail").append(
                "<tr class=\"\" data-id=\"" + val.ID + "\">" +
                    "<td><input type=\"checkbox\" class=\"chkEmail\" value=" + val.ID + "></td>" +
                    "<td class=\"inbox-small-cells\"><i class=\"fa fa-star\"></i></td>" +
                    "<td class=\"view-message hidden-xs\"><a data-id=\"" + val.ID + " class=\"titleEmail\">" + val.UserSendName + "</a></td>" +
                    "<td class=\"view-message\"><a data-id=\"" + val.ID + " class=\"titleEmail\">" + val.Title + "</a></td>" +
                    "<td class=\"view-message inbox-small-cells\"><i class=\"fa fa-paperclip\"></i></td>" +
                    "<td class=\"view-message text-right\"><a data-id=\"" + val.ID + " class=\"titleEmail\">" + toDateTime(val.CreateDate).toLocaleDateString() + " " + toDateTime(val.CreateDate).toLocaleTimeString() + " </a></td>" +
                "</tr>");
        });
    });

    var arrID = [];
    $("body").on("click", ".chkEmail", function () {
        var $this = $(this).val();
        if ($(this).is(":checked")) {
            arrID.push($this);
            $("#lstID").val(arrID.toString());
        } else {
            arrID.splice(arrID.indexOf($this), 1);
            $("#lstID").val(arrID.toString());
        }
    });

    $("#chkAll").on("change", function () {
        if ($(this).is(":checked")) {
            $('.chkEmail').prop('checked', true);
            $('.chkEmail :checked').each(function () {
                arrID.push($(".chkEmail").val());
                $("#lstID").val(arrID.toString());
            });
        } else {
            $('.chkEmail').prop('checked', false);
        }
    });


    // tự động lưu vào hộp thư nháp
  @*  $("body").on("change", "#UserReceiveId", function () {
        $.post("/DNMailSSC/ProcessDraftMailbox?idMail=" + $("#ID").val() + "&userId=" + $(this).val() + "&title=" + $("#Title").val() + "&content=" + $("#Content").val() + "&lstFile=" + $("#lstImages").val(), function (data) {
            if (data.Erros)
                createMessage("Đã có lỗi xảy ra", data.Message); // Tạo thông báo lỗi
            else {
                $("#ID").val(data.ID);
                socket.emit("client-send-auto-draft", { userId: '@FDI.Web.Controllers.BaseController.UserId' });
                $("#dialog-form").modal('hide'); //Đóng form thêm mới - sửa
            }
        });
    });*@
    
 @*   $("body").on("change", "#Title", function () {
        $.post("/DNMailSSC/ProcessDraftMailbox?idMail= " + $("#ID").val() + "&userId=" + $("#UserReceiveId").val() + "&title=" + $(this).val() + "&content=" + $("#Content").val() + "&lstFile=" + $("#lstImages").val(), function (data) {
            if (data.Erros)
                createMessage("Đã có lỗi xảy ra", data.Message); // Tạo thông báo lỗi
            else {
                $("#ID").val(data.ID);
                socket.emit("client-send-auto-draft", { userId: '@FDI.Web.Controllers.BaseController.UserId' });
                $("#dialog-form").modal('hide'); //Đóng form thêm mới - sửa
            }
        });
    });
    
    $("#Content").on("keypress", "#Content", function () {
        $.post("/DNMailSSC/ProcessDraftMailbox?userId=" + $("#UserReceiveId").val() + "&title=" + $("#Title").val() + "&content=" + $(this).val() + "&lstFile=" + $("#lstImages").val(), function (data) {
            if (data.Erros)
                createMessage("Đã có lỗi xảy ra", data.Message); // Tạo thông báo lỗi
            else {
                socket.emit("client-send-auto-draft", { userId: $("#UserReceiveId").val() });
                $("#dialog-form").modal('hide'); //Đóng form thêm mới - sửa
                createCloseMessage("Thông báo", data.Message, '#Page=1&itemId=' + data.ID + '&message=' + data.Message + '&temp=' + Math.floor(Math.random() * 11) + ''); // Tạo thông báo khi click đóng thì chuyển đến url đích
            }
        });
    });
    *@
    $("body").on("click", "#btnSend", function () {
        $("#Type").val($(this).data("status"));
    });
  
    $("body").on("click", "#btnDrafts", function() {
        $("#Type").val($(this).data("status"));
    });
        
    $("body").on("click", ".titleEmail", function () {
        $.post("/DNMailSSC/DetailsEmail?id=" + $(this).data("id"), function (data) {
            $("#inbox-content").html(data);
            socket.emit("client-send-mail", { userId: '@FDI.Web.Controllers.BaseController.UserId', type: 1 });
        });
    });

    // báo cáo spam
    $("body").on("click", "#reportSpam", function () {
        var action = parseInt($(this).data("status"));
        $.post("/DNMailSSC/UpdateType?lstId=" + $("#lstID").val() + "&status=" + $("#Type").val() + "&type=" + $(this).data("type"), function (data) {
            if (data.Erros == false) {
                // reset lai ID
                arrID.splice(arrID.indexOf($("#lstID").val("")), 1);
                $("#lstID").val(arrID.toString());
             
                socket.emit("client-send-spam", { userId: '@FDI.Web.Controllers.BaseController.UserId', type: $("#Type").val() });
            }
        });
    });

    // không phải spam
    $("body").on("click", "#NoReportSpam", function () {
        $.post("/DNMailSSC/UpdateType?lstId=" + $("#lstID").val() + "&status=" + '@Model.Type' + "&type=" + $(this).data("type"), function (data) {
            if (data.Erros == false) {
                // reset lai ID
                arrID.splice(arrID.indexOf($("#lstID").val("")), 1);
                $("#lstID").val(arrID.toString());
                socket.emit("client-send-no-spam", { userId: '@FDI.Web.Controllers.BaseController.UserId', type: 4 });
            }
        });
    });
    
    // chuyển thư nháp đến hộp thư đến
    $("body").on("click", "#MoveMailbox", function () {
        var action = parseInt($(this).data("status"));
        $.post("/DNMailSSC/UpdateType?lstId=" + $("#lstID").val() + "&status=" + $("#Type").val() + "&type=" + $(this).data("type"), function (data) {
            if (data.Erros == false) {
                // reset lai ID
                arrID.splice(arrID.indexOf($("#lstID").val("")), 1);
                $("#lstID").val(arrID.toString());
                socket.emit("client-send-move-mailbox", { userId: '@FDI.Web.Controllers.BaseController.UserId', type: action });
            }
         });
    });
    
    // xóa thư nháp
    $("body").on("click", "#btnDeleteDrafts", function () {
        alert('xóa thư nháp');
    });

    // cho vào thùng rác
    $("body").on("click", "#reportDelete", function () {
        swal({
            title: "Bạn có muốn chuyển vào Thùng rác không ?",
            type: "warning",
            showCancelButton: true,
            confirmButtonClass: "btn-success",
            cancelButtonText: "Hủy",
            confirmButtonText: "Xác nhận",
            closeOnConfirm: false,
            closeOnCancel: false
        },
        function (isConfirm) {
            if (isConfirm) {
                $.post("/DNMailSSC/ReportDelete?lstId=" + $("#lstID").val(), function (data) {
                    if (data.Erros == false) {
                        socket.emit("client-send-recyclebin", { userId: '@FDI.Web.Controllers.BaseController.UserId', type: '@Model.Type' });
                    }
                });
            }
            swal.close();
        });
    });

    // xóa vĩnh viễn
    $("body").on("click", "#btnDelete", function () {
        swal({
            title: "Bạn có muốn xóa vĩnh viễn thư này không ?",
            type: "warning",
            showCancelButton: true,
            confirmButtonClass: "btn-success",
            cancelButtonText: "Hủy",
            confirmButtonText: "Xác nhận",
            closeOnConfirm: false,
            closeOnCancel: false
        },
        function (isConfirm) {
            if (isConfirm) {
                $.post("/DNMailSSC/Delete?lstId=" + $("#lstID").val(), function (data) {
                    if (data.Erros == false) {
                        socket.emit("client-send-delete", { userId: '@FDI.Web.Controllers.BaseController.UserId', type: '@Model.Type' });
                    }
                });
            }
            swal.close();
        });
    });
</script>
</body>
</html>
